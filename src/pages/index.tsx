import { type NextPage } from "next";
import Head from "next/head";
import Link from "next/link";
import { useState } from "react";
import Cve from "~/components/cve";
import { CveModel } from "~/server/api/proto/compiled_proto/cve";
import { api } from "~/utils/api";
import { useUserStore } from "~/utils/zustand";

const Home: NextPage = () => {
  // user's global states
  const user = useUserStore((state) => state.user);
  const jwt = useUserStore((state) => state.jwt);

  const [page, setPage] = useState(1);

  // trpc
  const cves = api.cve.getMany.useQuery(
    {
      pageSize: 30,
      pageOffset: page,
      jwt,
    }
  );

  return (
    <>
      <Head>
        <title>Home | CVE Dashboard</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      
      <main className="flex min-h-screen flex-col items-center justify-center">
          {
            jwt === '' 
            ? 
            <div>
              <button className="text-white rounded-xl mx-4 mt-4 px-16 py-4 bg-blue-500 disabled:bg-gray-300 hover:bg-blue-400 transition"
                onClick={() => {
                  location.href = '/login'
                }}
              >
                Login
              </button>
              <button className="text-white rounded-xl mx-4 mt-4 px-16 py-4 bg-blue-500 disabled:bg-gray-300 hover:bg-blue-400 transition"
                onClick={() => {
                  location.href = '/register'
                }}
              >
                Register
              </button>
            </div>
            :
            <div className="text-center">
              <h1 className="mt-4 text-3xl">
                <b>Hello, {user}.</b>
              </h1>

              <div className="flex flex-col justify-center items-center">
                {cves.data?.cves.map((cve) => 
                  <Cve cve={cve} key={cve.cveId}/>
                )}
              </div>
            </div>
          }
      </main>
    </>
  );
};

export default Home;
